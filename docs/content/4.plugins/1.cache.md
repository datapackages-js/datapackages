---
title: Cache Plugin
description: A robust caching layer with support for memory, localStorage, and IndexedDB drivers.
---

# Cache

The `@datapackages/plugin-cache` middleware provides a robust caching layer for your datasets, supporting multiple storage drivers.

## Interaction Flow

::mermaid
<pre>
sequenceDiagram
    participant User
    participant DS as Dataset
    participant Plugin as withCache
    participant Driver as CacheDriver
    participant Origin as _load()

    User->>DS: init() / load()
    DS->>Plugin: load() [intercepted]
    Plugin->>Driver: get(key)
    
    alt Cache Hit
        Driver-->>Plugin: return data
        Plugin-->>DS: return data
    else Cache Miss
        Driver-->>Plugin: null
        Plugin->>Origin: call original _load()
        Origin-->>Plugin: return Data / Stream
        
        opt is Stream
            Note over Plugin: Accumulate items
        end
        
        Plugin->>Driver: set(key, data)
        Plugin-->>DS: return data
    end
    
    DS-->>User: Ready
</pre>
::

## Installation

```bash
npm install @datapackages/plugin-cache
```

## Usage

```typescript
import { withCache, IndexedDBDriver } from "@datapackages/plugin-cache";

await dataset.use(withCache({
  driver: new IndexedDBDriver(),
  ttl: 60 * 60 * 1000 // 1 hour
}));
```

## Drivers

- **MemoryDriver**: (Default) Fast, in-memory cache. Clears on page reload.
- **LocalStorageDriver**: Persists data to `localStorage`.
- **IndexedDBDriver**: Asynchronous, high-capacity storage for large datasets.

## Options

| Option   | Type          | Default        | Description                   |
| :------- | :------------ | :------------- | :---------------------------- |
| `driver` | `CacheDriver` | `MemoryDriver` | The storage backend to use.   |
| `ttl`    | `number`      | `undefined`    | Time-to-live in milliseconds. |
| `key`    | `string`      | service name   | Custom cache key.             |

## API Methods

### `clearCache()`

Available on the dataset instance after `.use(withCache())`. Clears the cached data for this dataset.

```typescript
await dataset.clearCache();
```

## Middleware Ordering

When combining with `@datapackages/plugin-stream`, the order of `.use()` calls matters. `withCache` should be applied **after** `withStream`:

```typescript
const ds = await dataset
  .use(withStream())
  .use(withCache());
```
